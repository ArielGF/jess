name: Deploy to Webempresa

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Check out the code
        uses: actions/checkout@v2

      - name: Set up Git
        run: git config --global user.email "youremail@example.com" && git config --global user.name "Your Name"

      - name: Get changed files
        id: changed-files
        run: |
          # Obtener la lista de archivos modificados entre el commit actual y el anterior
          git diff --name-only HEAD^ HEAD > changed-files.txt
          # Si no hay cambios, salir temprano
          if [ ! -s changed-files.txt ]; then
            echo "No changes detected. Exiting."
            exit 0
          fi
          # Mostrar los archivos modificados
          cat changed-files.txt
        continue-on-error: true

      - name: Sync changed files to Webempresa server
        if: success() # Solo se ejecuta si la tarea anterior no fall√≥
        uses: SamKirkland/FTP-Deploy-Action@4.3.0
        with:
          server: "178.33.115.23"
          username: "desarrollo@jessica2-cp27.wordpresstemporal.com"
          password: "arielDesarrollo2024"
          port: 21
          protocol: "ftps"
          local-dir: "./"
          # Solo subir los archivos modificados
          file-patterns: ${{ steps.changed-files.outputs.changed_files }}
